# Legacy persistent domain
#
# PIDs within this domain will be maintained but not extended.
# Incorrect mappings and mapping to underlying resources that change can be edited but no new patterns added.
#
# Implemented from PID Svc rules by Edmond Chuc, 13/08/2018
#
<VirtualHost *>
    ServerName environment.data.gov.au

	DocumentRoot /var/www/html/environment.data.gov.au
	DirectoryIndex index.html

	ErrorLog ${APACHE_LOG_DIR}/environment.data.gov.au/error.log
	CustomLog ${APACHE_LOG_DIR}/environment.data.gov.au/access.log combined

    RewriteEngine on


    ###############################
    #
    # MAPPINGS: Water Quality Observable Properties Ontology
    #
    # URI stem pattern: ^/water/quality/def/op(\.html|\.rdf)*$
    #
    ###############################

    ###############################
    #
    # - Default action with HTML or RDF optional extension
    # - It originally was a comparator in the PID service
    #
    # --- original pattern: ^/water/quality/def/op(\.html|\.rdf)*$
    # --- original action:  http://sissvoc.ereefs.info/repo/vocab/op
    # --- input:
    # --- result:
    #
    # --- test results: PASSED
    # --- input:    localhost/water/quality/def/op.html
    # --- output:   http://sissvoc.ereefs.info/repo/vocab/op.html
    # --- input:    localhost/water/quality/def/op.rdf
    # --- output:   http://sissvoc.ereefs.info/repo/vocab/op.rdf
    #
    # --- comment:
    RewriteRule ^water\/quality\/def\/op(\.html|\.rdf)$ http://sissvoc.ereefs.info/repo/vocab/op$1 [L,R=302]
    #
    ###############################

    ###############################
    #
    # - Content-Type HTML
    #
    # --- test results: PASSED
    # --- input:    $ curl -H "Accept: text/html" localhost/water/quality/def/op
    # --- output:   href="http://sissvoc.ereefs.info/repo/vocab/op.html"
    #
    # --- comment:
    RewriteCond %{HTTP:Accept} ^text\/html$ [NC]
    RewriteRule ^water\/quality\/def\/op$ http://sissvoc.ereefs.info/repo/vocab/op.html [L,R=302]
    #
    ###############################

    ###############################
    #
    # - Content-Type application/rdf+xml
    #
    # --- test results: PASSED
    # --- input:    $ curl -H "Accept: application/rdf+xml" localhost/water/quality/def/op
    # --- output:   href="http://sissvoc.ereefs.info/repo/vocab/op.rdf"
    #
    # --- comment:
    RewriteCond %{HTTP:Accept} ^application\/rdf\+xml$ [NC]
    RewriteRule ^water\/quality\/def\/op$ http://sissvoc.ereefs.info/repo/vocab/op.rdf [L,R=302]
    #
    ###############################


    ###############################
    #
    # MAPPINGS: Water Quality Vocabulary
    #
    # URI stem pattern: ^/water/quality/def/(.*)$
    #
    ###############################

    ###############################
    #
    # - Title
    #
    # --- original pattern: ^/water/quality/def/(.*)$
    # --- original action:  http://sissvoc.ereefs.info/sissvoc/ereefs/resource?_view=all&uri=http://environment.data.gov.au/def/${RAW:$1}
    #
    # --- test results: Original service is broken. Unable to test.
    #
    # --- comment: In PID svc, default action was: 301 Moved permanently
    RewriteRule ^water\/quality\/def\/(.*)$ http://sissvoc.ereefs.info/sissvoc/ereefs/resource?_view=all&uri=http://environment.data.gov.au/def/$1 [L,R=301]
    #
    ###############################


    ###############################
    #
    # MAPPINGS: eReefs legacy WQ def
    #
    # URI stem pattern: /water/quality/def(.*)
    #
    ###############################

    ###############################
    #
    # - eReefs legacy WQ def
    #
    # --- original pattern: /water/quality/def(.*)
    # --- original action:  http://environment.data.gov.au/def${RAW:$1}
    # --- input:            http://environment.data.gov.au/water/quality/def.html
    # --- result:           http://environment.data.gov.au/def.html
    #
    # --- test results: PASSED
    # --- input:    localhost/water/quality/def/aquifer
    # --- output:   http://environment.data.gov.au/def.html
    # --- comment:
    RewriteRule ^water\/quality\/def(.*) http://environment.data.gov.au/def$1 [L,R=302]
    #
    ###############################


    ###############################
    #
    # MAPPINGS: def OP
    #
    # URI stem pattern: /def/op(\.html|\.rdf)*$
    #
    ###############################

    ###############################
    #
    # - RDF in ACCEPT header
    #
    # --- original: accept=application/rdf\+xml
    # --- original action:  http://sissvoc.ereefs.info/repo/vocab/op.rdf
    # --- content-type: application/rdf+xml
    # --- input:
    # --- result:           http://sissvoc.ereefs.info/repo/vocab/op.rdf
    #
    # --- test results: PASSED
    # --- input:    $ curl -H "Accept: application/rdf+xml" localhost/def/op
    # --- output:   "http://sissvoc.ereefs.info/repo/vocab/op.rdf"
    #
    # --- comment:
    RewriteCond %{HTTP:Accept} ^application\/rdf\+xml$ [NC]
    RewriteRule ^def\/op$ http://sissvoc.ereefs.info/repo/vocab/op.rdf [L,R=302]
    #
    ###############################

    ###############################
    #
    # - HTML in ACCEPT header
    #
    # --- original pattern: accept=text/html
    # --- original action:  http://sissvoc.ereefs.info/repo/vocab/op.html
    # --- input:
    # --- result:           http://sissvoc.ereefs.info/repo/vocab/op.html
    #
    # --- test results: PASSED
    # --- input:    $ curl -H "Accept: text/html" localhost/def/op
    # --- output:   href="http://sissvoc.ereefs.info/repo/vocab/op.html"
    #
    # --- comment:
    RewriteCond %{HTTP:Accept} ^text\/html$ [NC]
    RewriteRule ^def\/op$ http://sissvoc.ereefs.info/repo/vocab/op.html [L,R=302]
    #
    ###############################


    ###############################
    #
    # - Query String for /def/op with format parameter
    #
    # --- original pattern: _format=application/rdf\+xml
    # --- original action:  op.rdf file
    # --- input:            http://environment.data.gov.au/def/op?_format=application/rdf+xml
    # --- result:           op.rdf file
    #
    # --- test results: PASSED
    # --- notes:    The test passed however, the query string appends to the redirected URL. Not sure why.
    # --- input:    localhost/def/op?_format=application/rdf+xml
    # --- output:   http://sissvoc.ereefs.info/repo/vocab/op.rdf?_format=application/rdf+xml
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_format=application\/rdf\+xml$
    RewriteRule ^def\/op$ http://sissvoc.ereefs.info/repo/vocab/op.rdf [L,R=302]
    #
    ###############################

    ###############################
    #
    # - HTML or RDF extension comparator
    #
    # --- original pattern: /def/op(\.html|\.rdf)*$
    # --- original action:  http://sissvoc.ereefs.info/repo/vocab/op.html or http://sissvoc.ereefs.info/repo/vocab/op.rdf
    # --- input:            environment.data.gov.au/def/op.html
    # --- result:           http://sissvoc.ereefs.info/repo/vocab/op.htm
    #
    # --- test results: ALL PASSED
    # --- input:    localhost/def/op.html
    # --- output:   http://sissvoc.ereefs.info/repo/vocab/op.html
    # --- input:    localhost/def/op.rdf
    # --- output:   http://sissvoc.ereefs.info/repo/vocab/op.rdf
    #
    # --- comment: Originally a comparator on the PID service.
    RewriteRule ^def\/op(\.html|\.rdf)$ http://sissvoc.ereefs.info/repo/vocab/op$1 [L,R=302]
    #
    ###############################

    ###############################
    #
    # - def OP for HTML and RDF/XML
    #
    # --- original pattern: /def/op(\.html|\.rdf)*$
    # --- original action:  http://registry2.it.csiro.au/def/op
    # --- input:            http://environment.data.gov.au/def/op.rdf
    # --- result:           http://environment.data.gov.au/def/op.rdf
    #
    # --- test results: PASSED
    # --- notes: This rule has been split in two from the original due to the different redirect endpoints
    # --- input:    localhost/def/op
    # --- output:   http://registry2.it.csiro.au/def/op
    #
    # --- comment:
    RewriteRule ^def\/op$ http://registry2.it.csiro.au/def/op [L,R=302]
    #
    ###############################


    ###############################
    #
    # MAPPINGS: def BA Glossary
    #
    # URI stem pattern: /def/ba/glossary(/.*)?
    #
    ###############################
    #
    # - Proxy
    #

    ###############################
    #
    # - def BA Glossary
    #
    # --- default proxy location: http://registry2.it.csiro.au/def/ba/glossary${RAW:$1}
    #
    # --- input:    http://environment.data.gov.au/def/ba/glossary/aquifer
    # --- output:   http://environment.data.gov.au/def/ba/glossary/aquifer
    #
    # --- test results: PASSED
    # --- input:    localhost/def/ba/glossary/aquifer
    # --- output:   http://registry2.it.csiro.au/def/ba/glossary
    #
    # --- comment: Originally it was a proxy on PID service, now a regular redirect
    RewriteRule ^/def/ba/glossary(/.*)$ http://registry2.it.csiro.au/def/ba/glossary$1 [L,R=302]
    #
    ###############################


    ###############################
    #
    # MAPPINGS: AHGF Feature specialisation River Regions
    #
    # URI stem pattern: ^/water/id/(riverregion)/([0-9]+)$
    #
    ###############################

    ###############################
    #
    # - SimpleFeatures or ahgf:RiverRegion with optional format
    #
    # --- original pattern: _view=(SimpleFeatures|ahgf:RiverRegion)&_format?
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:RiverRegion&Filter=<Filter><PropertyIsEqualTo><PropertyName>ahgf_hrr:HydroID</PropertyName><Literal>$1</Literal></PropertyIsEqualTo></Filter>&outputFormat=${C:_format}
    # --- input:            http://environment.data.gov.au/water/id/riverregion/91?_view=ahgf:RiverRegion&_format=test
    # --- result:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:RiverRegion&Filter=%3CFilter%3E%3CPropertyIsEqualTo%3E%3CPropertyName%3Eahgf_hrr:HydroID%3C/PropertyName%3E%3CLiteral%3Eriverregion%3C/Literal%3E%3C/PropertyIsEqualTo%3E%3C/Filter%3E&outputFormat=test
    #
    # --- test results: PASSED
    # --- input:            localhost/water/id/riverregion/99?_view=SimpleFeatures&_format=test
    # --- output:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:RiverRegion&Filter=%3cFilter%3e%3cPropertyIsEqualTo%3e%3cPropertyName%3eahgf_hrr:HydroID%3c/PropertyName%3e%3cLiteral%3eriverregion%3c/Literal%3e%3c/PropertyIsEqualTo%3e%3c/Filter%3e&outputFormat=test
    # --- input:            localhost/water/id/riverregion/99?_view=ahgf:RiverREgion
    # --- output:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:RiverRegion&Filter=%3cFilter%3e%3cPropertyIsEqualTo%3e%3cPropertyName%3eahgf_hrr:HydroID%3c/PropertyName%3e%3cLiteral%3eriverregion%3c/Literal%3e%3c/PropertyIsEqualTo%3e%3c/Filter%3e&outputFormat=
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=(SimpleFeatures|ahgf:RiverREgion)&_format=(.+)$
    RewriteRule ^water/id/(riverregion)/([0-9]+)$ http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:RiverRegion&Filter=<Filter><PropertyIsEqualTo><PropertyName>ahgf_hrr:HydroID</PropertyName><Literal>$1</Literal></PropertyIsEqualTo></Filter>&outputFormat=%2 [L,R=303]
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=(SimpleFeatures|ahgf:RiverREgion)(&_format=?)?$
    RewriteRule ^water/id/(riverregion)/([0-9]+)$ http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:RiverRegion&Filter=<Filter><PropertyIsEqualTo><PropertyName>ahgf_hrr:HydroID</PropertyName><Literal>$1</Literal></PropertyIsEqualTo></Filter>&outputFormat= [L,R=303]
    #
    ###############################

    ###############################
    #
    # - listaltids with optional format
    #
    # --- original pattern: _view=listaltids&_format?
    # --- original action:  http://sirf.csiro.au/sissvoc/lugf/listall?uri=${RAW:${ENV:FULL_REQUEST_URI}}
    # --- input:            http://environment.data.gov.au/water/id/riverregion/91?_view=listaltids&_format=test
    # --- result:           http://sirf.csiro.au/sissvoc/lugf/listall?uri=http://environment.data.gov.au/water/id/riverregion/91
    #
    # --- test results:
    # --- input:            http://localhost/water/id/riverregion/99?_view=listaltids
    # --- output:           http://sirf.csiro.au/sissvoc/lugf/listall?uri=http://environment.data.gov.au/water/id/riverregion/99
    # --- input:            http://localhost/water/id/riverregion/99?_view=listaltids&_format=test
    # --- output:           http://sirf.csiro.au/sissvoc/lugf/listall?uri=http://environment.data.gov.au/water/id/riverregion/99
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=listaltids(&_format=?(.+)?)?$
    RewriteRule ^water/id/(riverregion)/([0-9]+)$ http://sirf.csiro.au/sissvoc/lugf/listall?uri=http://environment.data.gov.au%{REQUEST_URI} [L,R=303]
    #
    ###############################

    ###############################
    #
    # - viewMap
    #
    # --- original pattern: _view=mapPreview
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.2&layers=ahgf_hrr:RiverRegion,ahgf_hrc:AHGFContractedCatchment,ahgf_shcarto:AHGFWaterbody,ahgf_shcarto:AHGFMappedStream&format=image/png&WIDTH=500&HEIGHT=500&BBOX=${RAW:${LOOKUP:http\://pid.ereefs.info/id/geo/riverregionBBOX:${ENV:FULL_REQUEST_URI}}}
    # --- input:
    # --- result:
    #
    # --- comment: TODO: lookup table
    #do stuff ...
    #
    ###############################


    ###############################
    #
    # MAPPINGS: AHGF Feature specialisation Drainage Divisions
    #
    # URI stem pattern: ^/water/id/(drainagedivision)/([0-9]+)$
    #
    ###############################

    ###############################
    #
    # - SimpleFeatures or ahgf:DrainageDivision with optional format
    #
    # --- original pattern: _view=(SimpleFeatures|ahgf:DrainageDivision)&_format?
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:AWRADrainageDivision&Filter=<Filter><PropertyIsEqualTo><PropertyName>ahgf_hrr:HydroID</PropertyName><Literal>$1</Literal></PropertyIsEqualTo></Filter>&outputFormat=${C:_format}
    # --- input:            http://environment.data.gov.au/water/id/drainagedivision/99?_view=SimpleFeatures&_format=test
    # --- result:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:AWRADrainageDivision&Filter=%3CFilter%3E%3CPropertyIsEqualTo%3E%3CPropertyName%3Eahgf_hrr:HydroID%3C/PropertyName%3E%3CLiteral%3Edrainagedivision%3C/Literal%3E%3C/PropertyIsEqualTo%3E%3C/Filter%3E&outputFormat=test
    #
    # --- test results: PASSED
    # --- input:    localhost/water/id/drainagedivision/99?_view=SimpleFeatures
    # --- output:   http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:AWRADrainageDivision&Filter=%3cFilter%3e%3cPropertyIsEqualTo%3e%3cPropertyName%3eahgf_hrr:HydroID%3c/PropertyName%3e%3cLiteral%3edrainagedivision%3c/Literal%3e%3c/PropertyIsEqualTo%3e%3c/Filter%3e&outputFormat=
    # --- input:    localhost/water/id/drainagedivision/99?_view=SimpleFeatures&_format=test
    # --- output:   http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:AWRADrainageDivision&Filter=%3cFilter%3e%3cPropertyIsEqualTo%3e%3cPropertyName%3eahgf_hrr:HydroID%3c/PropertyName%3e%3cLiteral%3edrainagedivision%3c/Literal%3e%3c/PropertyIsEqualTo%3e%3c/Filter%3e&outputFormat=test
    #
    # --- comment: if parameter is given
    RewriteCond %{QUERY_STRING} ^_view=(SimpleFeatures|ahgf:DrainageDivision)&_format=(.+)$
    RewriteRule ^water/id/(drainagedivision)/([0-9]+)$ http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:AWRADrainageDivision&Filter=<Filter><PropertyIsEqualTo><PropertyName>ahgf_hrr:HydroID</PropertyName><Literal>$1</Literal></PropertyIsEqualTo></Filter>&outputFormat=%2 [L,R=302]
    #
    # --- comment: optional format
    RewriteCond %{QUERY_STRING} ^_view=(SimpleFeatures|ahgf:DrainageDivision)(&_format=?)?$
    RewriteRule ^water/id/(drainagedivision)/([0-9]+)$ http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:AWRADrainageDivision&Filter=<Filter><PropertyIsEqualTo><PropertyName>ahgf_hrr:HydroID</PropertyName><Literal>$1</Literal></PropertyIsEqualTo></Filter>&outputFormat= [L,R=302]
    #
    ###############################

    ###############################
    #
    # - listaltids with optional format
    #
    # --- original pattern: _view=listaltids&_format?
    # --- original action:  http://sirf.csiro.au/sissvoc/lugf/listall?uri=${RAW:${ENV:FULL_REQUEST_URI}}
    # --- input:            http://environment.data.gov.au/water/id/drainagedivision/98?_view=listaltids&_format=test
    # --- result:           http://sirf.csiro.au/sissvoc/lugf/listall?uri=http://environment.data.gov.au/water/id/drainagedivision/98
    #
    # --- test results: PASSED
    # --- input:        http://localhost/water/id/drainagedivision/99?_view=listaltids
    # --- output:       http://sirf.csiro.au/sissvoc/lugf/listall?uri=http://environment.data.gov.au/water/id/drainagedivision/99
    # --- input:        localhost/water/id/drainagedivision/99?_view=listaltids&_format=test
    # --- output:       http://sirf.csiro.au/sissvoc/lu/listall?uri=http://environment.data.gov.au/water/id/drainagedivision/99&_format=test
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=listaltids(&_format=?)?$
    RewriteRule ^water/id/(drainagedivision)/([0-9]+)$ http://sirf.csiro.au/sissvoc/lugf/listall?uri=http://environment.data.gov.au%{REQUEST_URI} [L,R=302]
    #
    ###############################

    ###############################
    #
    # - mapPreview
    #
    # --- original pattern: _view=mapPreview
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.2&layers=ahgf_hrr:RiverRegion,AWRADrainageDivision,ahgf_shcarto:AHGFWaterbody,ahgf_shcarto:AHGFMappedStream&format=image/png&WIDTH=500&HEIGHT=500&BBOX=${RAW:${LOOKUP:http\://pid.ereefs.info/id/geo/riverregionBBOX:${ENV:FULL_REQUEST_URI}}}
    # --- input:
    # --- result:
    #
    # --- comment: TODO: it contains a lookup table
    #do stuff ...
    #
    ###############################


    ###############################
    #
    # MAPPINGS: AHGF Feature resources
    #
    # URI stem pattern: ^\/water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$
    #
    ###############################

    ###############################
    #
    # -- Alternates
    #
    # --- original pattern: _view=alternates&_format?
    # --- original action:  http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=${ENV:URI_REGISTER}&item=$2&_lang=en&_format=${ISNULL:${C:_format:0}:html}
    # --- input:            http://environment.data.gov.au/water/id/catchment/0?_view=alternates&_format=test
    # --- result:           http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=http%3A%2F%2Fenvironment.data.gov.au%2Fwater%2Fid%2Fcatchment&item=0&_lang=en&_format=test
    #
    # --- Currently the below implementation does not encode the redirected URL.
    #
    # --- test results: PASSED
    # --- input:        http://localhost/water/id/stream/99?_view=alternates&_format=test
    # --- output:       http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=http://environment.data.gov.au/water/id/stream&item=99&_lang=en&_format=test
    # --- input:        http://localhost/water/id/stream/99?_view=alternates
    # --- output:       http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=http://environment.data.gov.au/water/id/stream&item=99&_lang=en&_format=html
    #
    # --- comment: if it contains a format parameter with a given value
    RewriteCond %{QUERY_STRING} ^_view=alternates&_format=(.+)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=http://environment.data.gov.au/water/id/$1&item=$2&_lang=en&_format=%1 [L,R=302]
    #
    # --- comment: else
    RewriteCond %{QUERY_STRING} ^_view=alternates(&_format=?)?$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=http://environment.data.gov.au/water/id/$1&item=$2&_lang=en&_format=html [L,R=302]
    #
    ###############################

    ###############################
    #
    # - Lid or ID resolver
    #
    # --- original pattern: _view=^(lid|idresolver)&_format?
    # --- original action:  http://sirf.csiro.au/LdaIdService/resource?uri=${RAW:${ENV:FULL_REQUEST_URI}}&_format=${ISNULL:${C:_format:0}:html}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=idresolver
    # --- result:           http://sirf.csiro.au/LdaIdService/resource?uri=http://environment.data.gov.au/water/id/catchment/99&_format=html
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment/99?_view=lid&_format=test
    # --- output:           http://sirf.csiro.au/LdaIdService/resource?uri=http://environment.data.gov.au/water/id/catchment/99&_format=test
    #
    # --- comment: if it contains a format parameter with a given value
    RewriteCond %{QUERY_STRING} ^_view=(lid|idresolver)&_format=(.+)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/LdaIdService/resource?uri=http://environment.data.gov.au/water/id/$1/$2&_format=%2 [L,R=302]
    #
    # --- test results: PASSED
    # --- input:        http://localhost/water/id/waterbody/99?_view=idresolver&_format=test
    # --- output:       http://sirf.csiro.au/LdaIdService/resource?uri=http://environment.data.gov.au/water/id/waterbody/99&_format=test
    # --- input:        http://localhost/water/id/waterbody/99?_view=idresolver
    # --- output:       http://sirf.csiro.au/LdaIdService/resource?uri=http://environment.data.gov.au/water/id/waterbody/99&_format=html
    #
    # --- comment: else
    RewriteCond %{QUERY_STRING} ^_view=(lid|idresolver)(&_format=?)?$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/LdaIdService/resource?uri=http://environment.data.gov.au/water/id/$1/$2&_format=html [L,R=302]
    #
    ################################

    ################################
    #
    # - SimpleFeatures or ahgf:AHGFContractedCatchment
    #
    # --- original pattern: _view=(SimpleFeatures|ahgf:AHGFContractedCatchment)&_format=(csv|kml)
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrc:AHGFContractedCatchment&Filter=<Filter><PropertyIsEqualTo><PropertyName>ahgf_hrc:ConCatID</PropertyName><Literal>$2</Literal></PropertyIsEqualTo></Filter>&outputFormat=${C:_format}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=SimpleFeatures&_format=csv
    # --- output:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrc:AHGFContractedCatchment&Filter=%3CFilter%3E%3CPropertyIsEqualTo%3E%3CPropertyName%3Eahgf_hrc:ConCatID%3C/PropertyName%3E%3CLiteral%3E99%3C/Literal%3E%3C/PropertyIsEqualTo%3E%3C/Filter%3E&outputFormat=csv
    #
    # --- test results: PASSED
    # --- input:        localhost/water/id/catchment/99?_view=ahgf:AHGFContractedCatchment&_format=csv
    # --- output:       http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrc:AHGFContractedCatchment&Filter=%3cFilter%3e%3cPropertyIsEqualTo%3e%3cPropertyName%3eahgf_hrc:ConCatID%3c/PropertyName%3e%3cLiteral%3e99%3c/Literal%3e%3c/PropertyIsEqualTo%3e%3c/Filter%3e&outputFormat=csv
    #
    # --- comment: matches a view and send a a format type as a parameter
    RewriteCond %{QUERY_STRING} ^_view=(SimpleFeatures|ahgf:AHGFContractedCatchment)&_format=(csv|kml)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrc:AHGFContractedCatchment&Filter=<Filter><PropertyIsEqualTo><PropertyName>ahgf_hrc:ConCatID</PropertyName><Literal>$2</Literal></PropertyIsEqualTo></Filter>&outputFormat=%2 [L,R=302]
    #
    ###############################

    ###############################
    #
    # - QR Code with format as PNG
    #
    # --- original pattern: _view=qrcode&_format=png
    # --- original action:  ${RAW:${ENV:FULL_REQUEST_URI}}?_pidsvcqr=90
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=qrcode&_format=png
    # --- output:           http://environment.data.gov.au/water/id/catchment/99?_pidsvcqr=90
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/waterbody/99?_view=qrcode&_format=png
    # --- output:           http://environment.data.gov.au/water/id/waterbody/99?_pidsvcqr=90
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=qrcode&_format=png$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://environment.data.gov.au/water/id/$1/$2?_pidsvcqr=90 [L,R=302]
    #
    ###############################

    ###############################
    #
    # - SimpleFeatures or ahgf:AHGFContractedCatchment in GML format
    #
    # --- original pattern: _view=(SimpleFeatures|ahgf:AHGFContractedCatchment)&_format=gml
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrc:AHGFContractedCatchment&Filter=<Filter><PropertyIsEqualTo><PropertyName>ahgf_hrc:ConCatID</PropertyName><Literal>$2</Literal></PropertyIsEqualTo></Filter>
    # --- input:            environment.data.gov.au/water/id/catchment/99?_view=SimpleFeatures&_format=gml
    # --- result:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrc:AHGFContractedCatchment&Filter=%3CFilter%3E%3CPropertyIsEqualTo%3E%3CPropertyName%3Eahgf_hrc:ConCatID%3C/PropertyName%3E%3CLiteral%3E99%3C/Literal%3E%3C/PropertyIsEqualTo%3E%3C/Filter%3E
    #                       http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrc:AHGFContractedCatchment&Filter=%3cFilter%3e%3cPropertyIsEqualTo%3e%3cPropertyName%3eahgf_hrc:ConCatID%3c/PropertyName%3e%3cLiteral%3e99%3c/Literal%3e%3c/PropertyIsEqualTo%3e%3c/Filter%3e
    #
    # --- test results:     PASSED
    # --- input:            localhost/water/id/riverregion/99?_view=SimpleFeatures&_format=gml
    # --- output:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrr:RiverRegion&Filter=%3cFilter%3e%3cPropertyIsEqualTo%3e%3cPropertyName%3eahgf_hrr:HydroID%3c/PropertyName%3e%3cLiteral%3eriverregion%3c/Literal%3e%3c/PropertyIsEqualTo%3e%3c/Filter%3e&outputFormat=gml
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=(SimpleFeatures|ahgf:AHGFContractedCatchment)&_format=gml$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://geofabric.bom.gov.au/simplefeatures/ows?request=GetFeature&service=WFS&version=1.1.0&typeName=ahgf_hrc:AHGFContractedCatchment&Filter=<Filter><PropertyIsEqualTo><PropertyName>ahgf_hrc:ConCatID</PropertyName><Literal>$2</Literal></PropertyIsEqualTo></Filter> [L,R=302]
    #
    ###############################

    ###############################
    #
    # - Datanetwork
    #
    # --- original pattern: _view=datanetwork&_format?
    # --- original action:  http://sirf.csiro.au/sissvoc/dna/datanetwork?uri=${ENV:URI_REGISTER}&_lang=en&_format=${ISNULL:${C:_format:0}:html}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=datanetwork&_format
    # --- result:           http://sirf.csiro.au/sissvoc/dna/datanetwork?uri=http%3A%2F%2Fenvironment.data.gov.au%2Fwater%2Fid%2Fcatchment&_lang=en&_format=html
    #                       http://sirf.csiro.au/sissvoc/dna/datanetwork?uri=http://environment.data.gov.au/water/id/riverregion&_lang=en&_format=html
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment/99?_view=datanetwork&_format=test
    # --- output:           http://sirf.csiro.au/sissvoc/dna/datanetwork?uri=http://environment.data.gov.au/water/id/catchment&_lang=en&_format=test
    # --- input:            http://localhost/water/id/catchment/99?_view=datanetwork
    # --- output:           http://sirf.csiro.au/sissvoc/dna/datanetwork?uri=http://environment.data.gov.au/water/id/catchment&_lang=en&_format=html
    #
    # --- comment: if a format has been provided
    RewriteCond %{QUERY_STRING} ^_view=datanetwork&_format=(.+)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/sissvoc/dna/datanetwork?uri=http://environment.data.gov.au/water/id/$1&_lang=en&_format=%1 [L,R=302]
    # --- comment: else
    RewriteCond %{QUERY_STRING} ^_view=datanetwork(&_format=?)?$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/sissvoc/dna/datanetwork?uri=http://environment.data.gov.au/water/id/$1&_lang=en&_format=html [L,R=302]
    #
    ###############################

    ###############################
    #
    # - ahgf:AHGFCarto in KML format
    #
    # --- original pattern: _view=ahgf:AHGFCarto&_format=kml
    # --- original action:  http://cgeo-data2.csiro.au/geoserver/wms/kml?layers=ahgf_shcarto:AHGFWaterBody,ahgf_shcarto:AHGFMappedStream&CQL_FILTER=catchmentid=$2;catchmentid=$2
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=ahgf:AHGFCarto&_format=kml
    # --- result:           http://cgeo-data2.csiro.au/geoserver/wms/kml?layers=ahgf_shcarto:AHGFWaterBody,ahgf_shcarto:AHGFMappedStream&CQL_FILTER=catchmentid=99;catchmentid=99
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment/99?_view=ahgf:AHGFCarto&_format=kml
    # --- output:           http://cgeo-data2.csiro.au/geoserver/wms/kml?layers=ahgf_shcarto:AHGFWaterBody,ahgf_shcarto:AHGFMappedStream&CQL_FILTER=catchmentid=99;catchmentid=99
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=ahgf:AHGFCarto&_format=kml$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://cgeo-data2.csiro.au/geoserver/wms/kml?layers=ahgf_shcarto:AHGFWaterBody,ahgf_shcarto:AHGFMappedStream&CQL_FILTER=catchmentid=$2;catchmentid=$2 [L,R=302]
    #
    ###############################

    ###############################
    #
    # - ahgf:AHGFCarto in GML3 format
    #
    # --- original pattern: _view=ahgf:AHGFCarto&_format=gml3
    # --- original action:  http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:AHGFEstuary,ahgf_shcarto:AHGFWaterBody,ahgf_shcarto:AHGFMappedStream&CQL_FILTER=catchmentid=$2&outputFormat=gml3
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=ahgf:AHGFCarto&_format=gml3
    # --- result:           http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:AHGFEstuary,ahgf_shcarto:AHGFWaterBody,ahgf_shcarto:AHGFMappedStream&CQL_FILTER=catchmentid=99&outputFormat=gml3
    #
    # --- test results:     passed
    # --- input:            localhost/water/id/catchment/99?_view=ahgf:AHGFCarto&_format=gml3
    # --- output:           http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:AHGFEstuary,ahgf_shcarto:AHGFWaterBody,ahgf_shcarto:AHGFMappedStream&CQL_FILTER=catchmentid=99&outputFormat=gml3
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=ahgf:AHGFCarto&_format=gml3$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:AHGFEstuary,ahgf_shcarto:AHGFWaterBody,ahgf_shcarto:AHGFMappedStream&CQL_FILTER=catchmentid=$2&outputFormat=gml3 [L,R=302]
    #
    ###############################

    ###############################
    #
    # - ahgf:AHGFManmade in GML3 format
    #
    # --- original pattern: _view=ahgf:AHGFManmade&_format=gml3
    # --- original action:  http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:AHGFCanalLine,ahgf_shcarto:AHGFStructure,ahgf_shcarto:AHGFDam,ahgf_shcarto:AHGFWaterPipeline&CQL_FILTER=catchmentid=$2&outputFormat=gml3
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=ahgf:AHGFManmade&_format=gml3
    # --- result:           http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:AHGFCanalLine,ahgf_shcarto:AHGFStructure,ahgf_shcarto:AHGFDam,ahgf_shcarto:AHGFWaterPipeline&CQL_FILTER=catchmentid=99&outputFormat=gml3
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment/99?_view=ahgf:AHGFManmade&_format=gml3
    # --- output:           http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:AHGFCanalLine,ahgf_shcarto:AHGFStructure,ahgf_shcarto:AHGFDam,ahgf_shcarto:AHGFWaterPipeline&CQL_FILTER=catchmentid=99&outputFormat=gml3
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=ahgf:AHGFManmade&_format=gml3$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:AHGFCanalLine,ahgf_shcarto:AHGFStructure,ahgf_shcarto:AHGFDam,ahgf_shcarto:AHGFWaterPipeline&CQL_FILTER=catchmentid=$2&outputFormat=gml3 [L,R=302]
    #
    ###############################

    ###############################
    #
    # - ahgf:AHGFManmade in KML format
    #
    # --- original pattern: _view=ahgf:AHGFManmade&_format=kml
    # --- original action:  http://cgeo-data2.csiro.au/geoserver/wms/kml?layers=ahgf_shcarto:AHGFCanalLine,ahgf_shcarto:AHGFWaterPipeline,ahgf_shcarto:AHGFStructure,ahgf_shcarto:AHGFDam&CQL_FILTER=catchmentid=$2;catchmentid=$2;catchmentid=$2;catchmentid=$2
    # --- input:            environment.data.gov.au/water/id/catchment/99?_view=ahgf:AHGFManmade&_format=kml
    # --- result:           http://cgeo-data2.csiro.au/geoserver/wms/kml?layers=ahgf_shcarto:AHGFCanalLine,ahgf_shcarto:AHGFWaterPipeline,ahgf_shcarto:AHGFStructure,ahgf_shcarto:AHGFDam&CQL_FILTER=catchmentid=99;catchmentid=99;catchmentid=99;catchmentid=99
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=ahgf:AHGFManmade&_format=kml$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://cgeo-data2.csiro.au/geoserver/wms/kml?layers=ahgf_shcarto:AHGFCanalLine,ahgf_shcarto:AHGFWaterPipeline,ahgf_shcarto:AHGFStructure,ahgf_shcarto:AHGFDam&CQL_FILTER=catchmentid=$2;catchmentid=$2;catchmentid=$2;catchmentid=$2 [L,R=302]
    #
    ###############################

    ###############################
    #
    # - mapPreview
    #
    # --- original pattern: _view=mapPreview
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.3&layers=ahgf_hrc:AHGFContractedCatchment,ahgf_shcarto:AHGFWaterbody,ahgf_shcarto:AHGFMappedStream&format=image/png&WIDTH=500&HEIGHT=500&BBOX=${RAW:${LOOKUP:http\://pid.ereefs.info/id/geo/catchmentBBOX:${ENV:FULL_REQUEST_URI}}}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=mapPreview
    # --- result:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.3&layers=ahgf_hrc:AHGFContractedCatchment,ahgf_shcarto:AHGFWaterbody,ahgf_shcarto:AHGFMappedStream&format=image/png&WIDTH=500&HEIGHT=500&BBOX=
    #
    # --- comment: TODO: incomplete because of lookup map
    #RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.3&layers=ahgf_hrc:AHGFContractedCatchment,ahgf_shcarto:AHGFWaterbody,ahgf_shcarto:AHGFMappedStream&format=image/png&WIDTH=500&HEIGHT=500&BBOX=${RAW:${LOOKUP:http\://pid.ereefs.info/id/geo/catchmentBBOX:${ENV:FULL_REQUEST_URI}}} http://environment.data.gov.au%{REQUEST_URI} [L,R=302]
    #
    ###############################

    ###############################
    #
    # - altid and altns
    #
    # --- original pattern: _view=altid&altns&_format?
    # --- original action:  http://sirf.csiro.au/sissvoc/api/lu/alt?uri=${RAW:${ENV:FULL_REQUEST_URI}}&altns=${C:altns}&_format=${C:_format}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=altid&altns=234&_format=html
    # --- result:           http://sirf.csiro.au/sissvoc/api/lu/alt?uri=http://environment.data.gov.au/water/id/catchment/99&altns=234&_format=html
    #
    # --- comment: TODO: will this break if I hardcode it to require an altns value and a format value?
    #RewriteCond %{QUERY_STRING} ^_view=altid&altns=(.+)?(&_format=)?(.+)?$
    #
    ###############################

    ###############################
    #
    # - ahgf:network with PNG format
    #
    # --- original pattern: _view=ahgf:network&_format=png
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.2&layers=ahgf_shn:AHGFNetworkStream&format=image/png&WIDTH=500&HEIGHT=500&BBOX=${RAW:${LOOKUP:http\://pid.ereefs.info/id/geo/catchmentBBOX:${ENV:FULL_REQUEST_URI}}}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=ahgf:network&_format=png
    # --- result:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.2&layers=ahgf_shn:AHGFNetworkStream&format=image/png&WIDTH=500&HEIGHT=500&BBOX=
    #
    # --- comment: TODO: this has a lookup table, not sure how to implement it
    #do stuff ...
    #
    ###############################

    ###############################
    #
    # - =ahgf:network with optional format
    #
    # --- original pattern: _view=ahgf:network&_format?
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.2&layers=ahgf_shn:AHGFNetworkStream&format=${C:_format}&WIDTH=500&HEIGHT=500&BBOX=${RAW:${LOOKUP:http\://pid.ereefs.info/id/geo/catchmentBBOX:${ENV:FULL_REQUEST_URI}}}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=ahgf:network&_format?
    # --- result:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.2&layers=ahgf_shn:AHGFNetworkStream&format=&WIDTH=500&HEIGHT=500&BBOX=
    #
    # --- comment: TODO: this has a lookup table, not sure how to implement it
    #do stuff ...
    #
    ###############################

    ###############################
    #
    # - ahgf:cartographic with format in PNG
    #
    # --- original pattern: _view=ahgf:cartographic&_format=png
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.2&layers=ahgf_shcarto:AHGFWaterbody,ahgf_shcarto:AHGFMappedStream&format=image/png&WIDTH=500&HEIGHT=500&BBOX=${RAW:${LOOKUP:http\://pid.ereefs.info/id/geo/catchmentBBOX:${ENV:FULL_REQUEST_URI}}}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=ahgf:cartographic&_format=png
    # --- result:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.2&layers=ahgf_shcarto:AHGFWaterbody,ahgf_shcarto:AHGFMappedStream&format=image/png&WIDTH=500&HEIGHT=500&BBOX=
    #
    # --- comment: this has a lookup table, not sure how to implement it
    #do stuff ...
    #
    ###############################

    ###############################
    #
    # - ahgf:cartographic with optional format
    #
    # --- original pattern: _view=ahgf:cartographic&_format?
    # --- original action:  http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.2&layers=ahgf_shcarto:AHGFWaterbody,ahgf_shcarto:AHGFMappedStream&format=${C:_format}&WIDTH=500&HEIGHT=500&BBOX=${RAW:${LOOKUP:http\://pid.ereefs.info/id/geo/catchmentBBOX:${ENV:FULL_REQUEST_URI}}}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=ahgf:cartographic&_format?
    # --- result:           http://geofabric.bom.gov.au/simplefeatures/ows?request=GetMap&service=WMS&version=1.2&layers=ahgf_shcarto:AHGFWaterbody,ahgf_shcarto:AHGFMappedStream&format=&WIDTH=500&HEIGHT=500&BBOX=
    #
    # --- comment: this has a lookup table, not sure how to implement it
    #do stuff ...
    #
    ###############################

    ###############################
    #
    # - ahgf:sh_network with optional format
    #
    # --- original pattern: _view=ahgf:sh_network&_format?
    # --- original action:  http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shn:AHGFNetworkStream&CQL_FILTER=catchmentid=$2&outputFormat=${C:_format}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=ahgf:sh_network&_format=html
    # --- result:           http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shn:AHGFNetworkStream&CQL_FILTER=catchmentid=99&outputFormat=html
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment/99?_view=ahgf:sh_network&_format=test
    # --- output:           http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shn:AHGFNetworkStream&CQL_FILTER=catchmentid=99&outputFormat=test
    # --- input:            http://localhost/water/id/catchment/99?_view=ahgf:sh_network
    # --- output:           http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shn:AHGFNetworkStream&CQL_FILTER=catchmentid=99&outputFormat=
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=ahgf:sh_network&_format=(.+)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shn:AHGFNetworkStream&CQL_FILTER=catchmentid=$2&outputFormat=%1 [L,R=302]
    #
    # --- comment: TODO: review this next condition and rule, it might be redundant but it replicates the original functionality.
    RewriteCond %{QUERY_STRING} ^_view=ahgf:sh_network(&_format=?)?$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shn:AHGFNetworkStream&CQL_FILTER=catchmentid=$2&outputFormat= [L,R=302]
    #
    ###############################

    ###############################
    #
    # - listaltids with optional format
    #
    # --- original pattern: _view=listaltids&_format?
    # --- original action:  http://sirf.csiro.au/sissvoc/lu/listall?uri=${RAW:${ENV:FULL_REQUEST_URI}}&_format=${ISNULL:${C:_format:0}:html}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=listaltids&_format=test
    # --- result:           http://sirf.csiro.au/sissvoc/lu/listall?uri=http://environment.data.gov.au/water/id/catchment/99&_format=test
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment/99?_view=listaltids&_format=test
    # --- output:           http://sirf.csiro.au/sissvoc/lu/listall?uri=http://environment.data.gov.au/water/id/catchment/99&_format=test
    # --- input:            http://localhost/water/id/catchment/99?_view=listaltids
    # --- output:           http://sirf.csiro.au/sissvoc/lu/listall?uri=http://environment.data.gov.au/water/id/catchment/99&_format=html
    #
    # --- comment: if a format parameter is given
    RewriteCond %{QUERY_STRING} ^_view=listaltids&_format=(.+)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/sissvoc/lu/listall?uri=http://environment.data.gov.au%{REQUEST_URI}&_format=%1 [L,R=302]
    #
    # --- comment: default the format to HTML
    RewriteCond %{QUERY_STRING} ^_view=listaltids(&_format=?)?$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/sissvoc/lu/listall?uri=http://environment.data.gov.au%{REQUEST_URI}&_format=html [L,R=302]
    #
    ###############################

    ###############################
    #
    # - Related with optional format
    #
    # --- original pattern: _view=^related$&_format?
    # --- original action:  http://sirf.csiro.au/sissvoc/lugf/related?uri=${RAW:${ENV:FULL_REQUEST_URI}}&_format=${ISNULL:${C:_format:0}:html}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=related&_format=test
    # --- result:           http://sirf.csiro.au/sissvoc/lugf/related?uri=http://environment.data.gov.au/water/id/catchment/99&_format=test
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment/99?_view=related&_format=test
    # --- output:           http://sirf.csiro.au/sissvoc/lugf/related?uri=http://environment.data.gov.au/water/id/catchment/99&_format=test
    # --- input:            http://localhost/water/id/catchment/99?_view=related
    # --- output:           http://sirf.csiro.au/sissvoc/lugf/related?uri=http://environment.data.gov.au/water/id/catchment/99&_format=html
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=related&_format=(.+)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/sissvoc/lugf/related?uri=http://environment.data.gov.au%{REQUEST_URI}&_format=%1 [L,R=302]
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=related(&_format=?)?$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/sissvoc/lugf/related?uri=http://environment.data.gov.au%{REQUEST_URI}&_format=html [L,R=302]
    #
    ###############################

    ###############################
    #
    # - monitoringpoints with optional format
    #
    # --- original pattern: _view=^monitoringpoints$&_format?
    # --- original action:  http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:GhostNodes&CQL_FILTER=ahgf_shcarto:catchmentid=$2&_format=${C:_format}
    # --- input:            http://environment.data.gov.au/water/id/catchment/99?_view=monitoringpoints&_format=test
    # --- result:           http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:GhostNodes&CQL_FILTER=ahgf_shcarto:catchmentid=99&_format=test
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment/99?_view=monitoringpoints&_format=test
    # --- output:           http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:GhostNodes&CQL_FILTER=ahgf_shcarto:catchmentid=99&_format=test
    # --- input:            http://localhost/water/id/catchment/99?_view=monitoringpoints
    # --- output:           http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:GhostNodes&CQL_FILTER=ahgf_shcarto:catchmentid=99&_format=
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=monitoringpoints&_format=(.+)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:GhostNodes&CQL_FILTER=ahgf_shcarto:catchmentid=$2&_format=%1 [L,R=302]
    #
    # --- comment:
    RewriteCond %{QUERY_STRING} ^_view=monitoringpoints(&_format=?)?$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://cgeo-data2.csiro.au/geoserver/ows?service=wfs&version=1.1.0&request=GetFeature&typeName=ahgf_shcarto:GhostNodes&CQL_FILTER=ahgf_shcarto:catchmentid=$2&_format= [L,R=302]
    #
    ###############################

    ###############################
    #
    # - Default action:
    #
    ###############################
    #
    # -- original pattern: ^\/water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$
    # -- original action: http://sirf.csiro.au/LdaIdService/resource?uri=${RAW:${ENV:FULL_REQUEST_URI}}&_format=html
    # -- input:  http://environment.data.gov.au/water/id/catchment/0
    # -- result: http://sirf.csiro.au/LdaIdService/resource?uri=http://environment.data.gov.au/water/id/catchment/0&_format=html
    #
    # --- test results      PASSED
    # --- input:            http://localhost/water/id/waterbody/98
    # --- output:           http://sirf.csiro.au/LdaIdService/resource?uri=http://environment.data.gov.au/water/id/waterbody/98&_format=html
    #
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/([0-9]+)$ http://sirf.csiro.au/LdaIdService/resource?uri=http://environment.data.gov.au/water/id/$1/$2&_format=html [L,R=302]
    #
    ###############################


    ###############################
    #
    # MAPPINGS: AHGF Feature class registers
    #
    # URI stem pattern: ^\/water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$
    #
    ##############################

    ##############################
    # --- HTML
    #
    # if it contains the query string (with escaped question mark)
    #
    # --- test results:     PASSED
    # --- input:            localhost/water/id/catchment?_view=iso19115&_format?=html
    # --- output:           http://www.bom.gov.au/metadata/catalogue/view/ANZCW0503900107.shtml?_view=iso19115&_format?=html
    #
    RewriteCond %{QUERY_STRING} ^_view=iso19115&_format\?=html$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ http://www.bom.gov.au/metadata/catalogue/view/ANZCW0503900107.shtml [L,R=302]
    #
    # --- XML
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment?_view=iso19115&_format=xml
    # --- output:           http://www.bom.gov.au/metadata/catalogue/view/ANZCW0503900107.xml?_view=iso19115&_format=xml
    #
    RewriteCond %{QUERY_STRING} ^_view=iso19115&_format=xml$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ http://www.bom.gov.au/metadata/catalogue/view/ANZCW0503900107.xml [L,R=302]
    #
    ##############################

    ##############################
    # --- Alternates
    # ---- comment:
    # ----- replicating this pattern _view=^alternates$&_format?
    # ----- to http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=${ENV:FULL_REQUEST_URI}&item=&_format=${ISNULL:${C:_format:1}:html}&_lang=en
    #
    # ----- if it contains the _format parameter
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment?_view=alternates&_format=test
    # --- output:           http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=http://environment.data.gov.au/water/id/catchment&item=&_format=test&_lang=en
    # --- input:            http://localhost/water/id/catchment?_view=alternates
    # --- output:           http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=http://environment.data.gov.au/water/id/catchment&item=&_format=html&_lang=en
    #
    RewriteCond %{QUERY_STRING} ^_view=alternates&_format=(.*)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=http://environment.data.gov.au%{REQUEST_URI}&item=&_format=%1&_lang=en [L,R=302]
    #
    # ----- else if it does not contain the _format parameter, then default the rewrite rule parameter to html
    #
    RewriteCond %{QUERY_STRING} ^_view=alternates$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ http://sirf.csiro.au/sissvoc/lid/resourcelist?baseuri=http://environment.data.gov.au%{REQUEST_URI}&item=&_format=html&_lang=en [L,R=302]
    #
    ##############################

    ##############################
    # --- Downloads
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment?_view=download
    # --- output:           ftp://ftp.bom.gov.au/anon/home/geofabric/
    #
    RewriteCond %{QUERY_STRING} ^_view=download$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ ftp://ftp.bom.gov.au/anon/home/geofabric/ [L,R=302]
    #
    ##############################

    ##############################
    # --- List lookups
    # ---- comment:
    # ----- replicating this pattern _view=^listlookups$&_format?
    # ----- to http://sirf.csiro.au/sissvoc/dna/linkedgazlist?uri=${ENV:FULL_REQUEST_URI}&_format=${ISNULL:${C:_format:1}:html}&_lang=en
    #
    # --- test results:
    # --- input:            http://localhost/water/id/catchment?_view=listlookups&_format=test
    # --- output:           http://sirf.csiro.au/sissvoc/dna/linkedgazlist?uri=http://environment.data.gov.au/water/id/catchment&_format=test&_lang=en
    # --- input:            http://localhost/water/id/catchment?_view=listlookups
    # --- output:           http://sirf.csiro.au/sissvoc/dna/linkedgazlist?uri=http://environment.data.gov.au/water/id/catchment&_format=html&_lang=en
    #
    # ----- if _format parameter provided
    #
    RewriteCond %{QUERY_STRING} ^_view=listlookups&_format=(.*)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ http://sirf.csiro.au/sissvoc/dna/linkedgazlist?uri=http://environment.data.gov.au%{REQUEST_URI}&_format=%1&_lang=en [L,R=302]
    #
    # ----- else
    #
    RewriteCond %{QUERY_STRING} ^_view=listlookups$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ http://sirf.csiro.au/sissvoc/dna/linkedgazlist?uri=http://environment.data.gov.au%{REQUEST_URI}&_format=html&_lang=en [L,R=302]
    #
    #############################

    #############################
    # --- List related
    # ---- comment:
    # ----- replicating this pattern _view=^listrelated$&_format?
    # ----- to http://sirf.csiro.au/sissvoc/dna/related?uri=${ENV:FULL_REQUEST_URI}&_lang=en&_format=${ISNULL:${C:_format:1}:html}
    #
    # ----- if _format parameter
    #
    # --- test results:     PASSED
    # --- input:            localhost/water/id/catchment?_view=listrelated&_format=test
    # --- output:           http://sirf.csiro.au/sissvoc/dna/related?uri=http://environment.data.gov.au/water/id/catchment&_lang=en&_format=test
    # --- input:            http://localhost/water/id/catchment?_view=listrelated
    # --- output:           http://sirf.csiro.au/sissvoc/dna/related?uri=http://environment.data.gov.au/water/id/catchment&_lang=en&_format=html
    #
    RewriteCond %{QUERY_STRING} ^_view=listrelated&_format=(.*)$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ http://sirf.csiro.au/sissvoc/dna/related?uri=http://environment.data.gov.au%{REQUEST_URI}&_lang=en&_format=%1 [L,R=302]
    #
    # ----- else
    #
    RewriteCond %{QUERY_STRING} ^_view=listrelated$
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ http://sirf.csiro.au/sissvoc/dna/related?uri=http://environment.data.gov.au%{REQUEST_URI}&_lang=en&_format=html [L,R=302]
    #
    #############################

    #############################
    # --- Data network
    # ---- comment:
    # ----- replicating this pattern _view=^datanetwork$&_format?
    # ----- to http://sirf.csiro.au/sissvoc/dna/datanetwork?uri=${ENV:FULL_REQUEST_URI}
    #
    # ----- if _format parameter
    #
    # --- test results:     PASSED
    # --- input:            localhost/water/id/catchment?_view=datanetwork
    # --- output:           http://sirf.csiro.au/sissvoc/dna/datanetwork?uri=http://environment.data.gov.au/water/id/catchment
    #
    RewriteCond %{QUERY_STRING} ^_view=datanetwork
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ http://sirf.csiro.au/sissvoc/dna/datanetwork?uri=http://environment.data.gov.au%{REQUEST_URI} [L,R=302]
    #
    #############################

    #############################
    # --- Lid
    # ---- comment:
    # ----- replicating this pattern _view=lid$&_format?
    # ----- to http://sirf.csiro.au/sissvoc/dna/resource?uri=${ENV:FULL_REQUEST_URI}
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment?_view=lid
    # --- output:           http://sirf.csiro.au/sissvoc/dna/resource?uri=http://environment.data.gov.au/water/id/catchment
    #
    RewriteCond %{QUERY_STRING} ^_view=lid
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)$ http://sirf.csiro.au/sissvoc/dna/resource?uri=http://environment.data.gov.au%{REQUEST_URI} [L,R=302]

    ###############################
    #
    # - Default action:
    # -- comment:
    #
    # --- test results:     PASSED
    # --- input:            http://localhost/water/id/catchment/
    # --- output:           http://sirf.csiro.au/sissvoc/dna/resource?uri=http://environment.data.gov.au/water/id/catchment/
    #
    RewriteRule ^water\/id\/(catchment|riverregion|drainagedivision|stream|waterbody)\/?$ http://sirf.csiro.au/sissvoc/dna/resource?uri=http://environment.data.gov.au%{REQUEST_URI} [L,R=302]
    #
    ###############################

</VirtualHost>
